<!DOCTYPE html>
<html>
<head>
	<title>VISA Card App</title>

	<meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="css/jquery.mobile-1.4.3.min.css" />
	<script src="js/jquery-2.0.3.min.js"></script>
	<script src="js/jquery.mobile-1.4.3.min.js"></script>
</head>
<body>
<div data-role="popup" data-overlay-theme="b" data-theme="b" id="errorpopup">
  		<p id="errmsg"></p>
</div>

<div data-role="page" id="cardPage">
	<div data-role="dialog" id="popupAddCard" data-theme="a" class="ui-corner-all">
	    <form>
	        <div style="padding:10px 20px;">
	            <h3>Please sign in</h3>
	            <label for="un" class="ui-hidden-accessible">Username:</label>
	            <input type="text" name="user" id="un" value="" placeholder="username" data-theme="a">
	            <label for="pw" class="ui-hidden-accessible">Password:</label>
	            <input type="password" name="pass" id="pw" value="" placeholder="password" data-theme="a">
	            <button type="submit" class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-btn-icon-left ui-icon-check">Sign in</button>
	        </div>
	    </form>
	</div>

	<div data-role="popup" id="popupMenu" data-theme="a">
        <ul data-role="listview">            
            <li data-icon="plus" ><a href="#" data-popup="popupAddCard" class="opopup">Add Card</a></li>
            <li data-icon="info"><a href="#">Logout</a></li>            
        </ul>
	</div>
	
	<div data-role="header" data-theme="a">
		 <p>&nbsp;</p>
		 <a style="padding-left:0.5em" data-rel="popup" href="#popupMenu" class="ui-btn-right ui-btn ui-corner-all ui-btn-icon-right ui-icon-gear">Options</a>
	</div><!-- /header -->
	<div role="main" class="ui-content">
		
	</div><!-- /content -->
</div><!-- /page -->


<div data-role="page" id="loginPage">	
	
	<div role="main" class="ui-content">		
		<div id="loginCont" style="margin-top:30%">					
			<div class="ui-grid-a">
      			<div class="ui-block-a" style="width:20%">
        			<input type="text" name="lgnCnCode" id="lgnCnCode" placeholder="+65">
      			</div>
      			<div class="ui-block-b" style="width:2%">
      			</div>
			    <div class="ui-block-c" style="width:78%">
        			<input type="text" name="lgnPNum" id="lgnPNum" placeholder="Phone Number">
      			</div>
      		</div>
			<input type="password" id="lgnPwd" placeholder="Password" />
			<div class="ui-grid-a" style="text-align:center">				
				<button id="login" class="ui-btn ui-btn-inline ui-shadow ui-mini">Login</button>
			</div>
			<div style="margin-top:4%;text-align:center">
				<button data-page="regPage" class="cpage ui-btn ui-btn-inline ui-shadow ui-mini">SignUp</button>
			</div>
		</div>
	</div><!-- /content -->
</div><!-- /page -->

<div data-role="page" id="regPage">
	<div data-role="main" class="ui-content">
		<div style="margin-top:30%">
			<div class="ui-grid-a">
      			<div class="ui-block-a" style="width:20%">
        			<input type="text" name="regCnCode" id="regCnCode" placeholder="+65">
      			</div>
  				<div class="ui-block-b" style="width:2%">
  				</div>
			    <div class="ui-block-c" style="width:78%">
        			<input type="text" name="regPNum" id="regPNum" placeholder="Phone Number">
      			</div>
      		</div>
      		<div align="center">
      		<input type="password" name="regpw1" id="regpw1" placeholder="Password">
      		<input type="password" name="regpw2" id="regpw2" placeholder="Confirm Password">
      		</div>
      		<div align="center">
      			<button id="reg" class="ui-btn ui-btn-inline ui-shadow ui-mini">Register</button>    		
    		</div>
    		<div style="margin-top:4%;text-align:center">
				<button data-page="loginPage" class="cpage ui-btn ui-btn-inline ui-shadow ui-mini">Login</button>
			</div>
		</div>
	</div><!-- /content -->
</div> <!-- /page -->




<script src="js/common.js"></script>
<script type="text/javascript">

	$("document").ready(function(){
		$("#errorpopup").enhanceWithin().popup();
		$(".cpage").on("click",onChangePageButtonClick);
		$(".opopup").on("click",onOpenPopUpButtonClick);
		$("#reg").on("click",onRegistrationClick);
		$("#login").on("click",onLoginClick);

	});
	
	function onOpenPopUpButtonClick(){
		
		var btn = $(this);
		
		$.mobile.changePage("#popupAddCard",true,true,"pop");
		//$("#"+btn.attr("data-popup")).popup("open");
	}
	
	function onChangePageButtonClick(){
		
		var btn = $(this);
		$.mobile.changePage("#"+btn.attr("data-page"));
		
	}

	function onRegistrationClick(){


		var cc = $("#regCnCode").val(),
			pn = $("#regPNum").val(),
			pwd = $("#regpw1").val(),
			cpwd = $("#regpw1").val();
		
		$.mobile.loading('show');
		$.ajax({

			url:common.baseUrl+"/register",
			data:{"cc":cc,"pn":pn,"pwd":pwd,"cpwd":cpwd},
			type:"POST",
			crossDomain :true,
			success:function(data){
				
				data = $.parseJSON(data);
				$.mobile.loading('hide');				

				if(data["REQUEST_STATUS"] == 1){
					$.mobile.changePage("#cardPage");	
				}else{
					$("#errmsg").html(data["REQUEST_MESSAGE"]);
					$("#errorpopup").popup("open");
				}
			},
			error:function(err){
				$.mobile.loading('hide');
				$("#errmsg").html("Seems like we lost the connection.");
				$("#errorpopup").popup("open");
			}

		});


	}


	function onLoginClick(){


		var cc = $("#lgnCnCode").val(),
			pn = $("#lgnPNum").val(),
			pwd = $("#lgnPwd").val();
					
		$.mobile.loading('show');
		$.ajax({

			url:common.baseUrl+"/login",
			data:{"cc":cc,"pn":pn,"pwd":pwd},
			type:"POST",
			crossDomain :true,
			success:function(data){

				data = $.parseJSON(data);
				$.mobile.loading('hide');
				
				
				if(data["REQUEST_STATUS"] == 1){
					$.mobile.changePage("#cardPage");	
				}else{
					$("#errmsg").html(data["REQUEST_MESSAGE"]);
					$("#errorpopup").popup("open");
				}
			},
			error:function(err){
				
				$.mobile.loading('hide');
				$("#errmsg").html("Seems like we lost the connection.");
				$("#errorpopup").popup("open");
				

			}

		});


	}

</script>

</body>
</html>